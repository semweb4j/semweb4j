<?xml version="1.0"?>
<project name="rdf2go-sesame2" default="zip-all" basedir=".">
	
	<property name="version-number" value="3.1" />
	<property name="product-name" value="rdf2go-sesame2" />
	<property name="product-title" value="RDF2Go Sesame 2 Adaptor" />
	<property name="creator" value="AIFB Karlsruhe, Max Voelkel (Max VÃ¶lkel), Sebastian Gerke"/>
	
	<fileset dir="lib" id="all-libs">
		<include name="rdf2go-3.1.jar"/>
		<include name="junit.jar"/>
	    <include name="openrdf-model.jar"/>
		<include name="openrdf-util.jar"/>
		<include name="rio.jar"/>
		<include name="sesame.jar"/>
		<include name="sparql-core.jar"/>
		<include name="sparql-sesame.jar"/>
		<include name="sparql-tests.jar"/>
		<include name="commons-logging.jar" />
		<include name="log4j-1.2.12.jar" />
	</fileset>
	
	<target name="log" description="enables tracking the build process itself">
		<buildnumber file="build.number"/>
	</target>
	
	<target name="temp" description="crete and clean temp, create dest">
		<mkdir description="prepare temp dir" dir="temp"/>
		<delete>
			<fileset dir="temp" includes="**/*"/>
		</delete>
		<mkdir description="prepare temp dir" dir="temp"/>
		<mkdir description="prepare temp dir" dir="temp/dest"/>
	    <mkdir dir="dest" />
	</target>
	
    <target name="jar" depends="log, temp">
       <echo>Compiling ...</echo>
       <mkdir dir="temp/build" />
       <javac destdir="temp/build"
       compiler="javac1.5"  source="1.5"  verbose="false" >
       	<src path="src"/>
       	<src path="test-src"/>
    	<classpath>
    	      <pathelement path="${classpath}"/>
    	      <fileset dir="lib">
    	        <include name="**/*.jar"/>
    	      </fileset>
    	      <pathelement location="temp/build"/>
        </classpath>
       </javac>

    	<mkdir dir="temp/manifest" />
      	<echo>Creating manifest ...</echo>
        	<manifest file="temp/manifest/MANIFEST.MF"  >
    	    <attribute name="Built-By" value="${user.name}"/>
        	<attribute name="Built-Number" value="${build.number}"/>
    	    <section name="common">
    	      <attribute name="Specification-Title" value="Example"/>
    	      <attribute name="Specification-Version" value="${version-number}"/>
    	      <attribute name="Specification-Vendor" value="${creator}"/>
    	      <attribute name="Implementation-Title" value="${product-title}}"/>
    	      <attribute name="Implementation-Version" value="${version-number} ${TODAY}"/> 
    	      <attribute name="Implementation-Vendor" value="${creator}"/>
    	    </section>
    	  </manifest>
    	<echo>Creating JAR ...</echo>
    	<jar basedir="temp/build" compress="true" manifest="temp/manifest/MANIFEST.MF" manifestencoding="UTF-8"
    	   destfile="dest/${product-name}.jar" />
    	<copy file="dest/${product-name}.jar" 
    		tofile="dest/${product-name}-current.jar"
    		/>
    </target>
	
	<target name="build" depends="jar" description="copy the jar and all libs of this project to dest/build (used by the buildmanager)">
		<echo>Copying all libs and the rdf2go-sesame2.jar to dest/build</echo>
		<mkdir dir="dest/build" />
		<copy description="copy all libs on which this project depends" todir="dest/build">
			<fileset refid="all-libs" /> 
		</copy>
		<copy file="dest/${product-name}.jar" todir="dest/build" />	
	</target>
	
	<target name="javadoc" depends="temp" >
		<!-- create javadocs -->
		<javadoc
		access="public" 
		author="true" 
		destdir="temp/javadoc" 
		doctitle="${product-title}"
		failonerror="true"
		linksource="true"
		nodeprecated="false" 
		nodeprecatedlist="false" 
		noindex="false" 
		nonavbar="false" 
		notree="false" 
		overview="src/overview.html" 
		source="1.5"
		sourcepath="src;test-src" 
		splitindex="true" 
		use="true"
		verbose="false"
		version="true"
		windowtitle="${product-title}"
		>
		
		    <sourcepath>
		    	<pathelement location="src"/>
		    	<pathelement location="test-src"/>
		    </sourcepath>
			<packageset dir="src" />
	    	<classpath description="TODO: re-use">
	    	      <pathelement path="${classpath}"/>
	    	      <fileset dir="lib">
	    	        <include name="**/*.jar"/>
	    	      </fileset>
	    	      <pathelement location="build"/>
	        </classpath>
			<package name="org.ontoware.rdf2go.impl.jackrabbit"/>
		</javadoc>
		<zip description="create doc-zip"
		       	basedir="temp/javadoc" compress="true" whenempty="fail" 
		       	zipfile="dest/javadoc-${version-number}.zip" />
	</target>
		
	<target name="src-zip" depends="temp">
		<!-- create src.zip -->
		<copy description="copy sources" todir="temp/src">
			<fileset dir="src" includes="**/*" />
			<fileset dir="test-src" includes="**/*" />
			<!-- examples, ...-->
		</copy>
	   <zip description="create src-zip"
	       	basedir="temp/src" compress="true" whenempty="fail" 
	       	zipfile="dest/src-${version-number}.zip" />
	</target>
	
	<target name="test" depends="jar">
		<!-- TODO test -->
		<junit fork="yes">
			<test name="org.ontoware.rdf2go.impl.jackrabbit.JackrabbitTest" />
			<test name="org.ontoware.rdf2go.impl.jackrabbit.ModelImplJackrabbitTest" />
		</junit>
	</target>
	
	<target name="zip-all" depends="src-zip, jar, temp, javadoc">
		<copy description="copy libs" todir="temp/dest/lib">
			<fileset dir="lib" includes="**/*.jar" />
		</copy>
		<copy description="copy rdf2go" todir="temp/dest/lib">
			<fileset dir="dest">
	       	  <filename name="${product-name}-${version-number}.jar" />
	       	</fileset>
		</copy>
		<copy file="dest/src-${version-number}.zip"
		tofile="temp/dest/src.zip" />
		<copy file="dest/javadoc-${version-number}.zip"
		tofile="temp/dest/javadocs.zip" />
		
		<copy todir="temp/dest"><fileset dir=".">
			 <include name="changelog.txt"/>
		</fileset></copy>

       <zip description="create zip"
       	basedir="temp/dest" compress="true" whenempty="fail" 
       	zipfile="dest/${product-name}-${version-number}-all.zip" />
	</target>

</project>